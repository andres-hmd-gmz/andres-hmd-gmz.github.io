<!-- =========================
   Andrés Ahumada Gómez — Blog
   ========================= -->


<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Math Site of Andrés</title>
  <meta name="description" content="Web profesional de Andrés Ahumada Gómez." />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=CMU+Serif&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/cascadia-code/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono/index.css">
  <link rel="stylesheet" href="/styles.css" />
  <link rel="alternate" hreflang="en" href="https://andres-ahumada-gomez.github.io/en/" />
<link rel="alternate" hreflang="es" href="https://andres-ahumada-gomez.github.io/es/" />
<link rel="alternate" hreflang="x-default" href="https://andres-ahumada-gomez.github.io/" />
   <link rel="icon" type="image/png" href="/imgs/esf.png">
</head>
<body>
  <header class="site-header">
  <a class="brand" href="/">
  <img src="/imgs/andres-esf2.png" alt="Logo" class="brand-logo">
     
  Andrés Ahumada Gómez
  </a>
  <nav class="nav">
  <a class="active" href="/blog/">Blog</a>
  

  <span class="nav-sep" aria-hidden="true">|</span>

  <div class="lang">
    <a href="/en/">Home</a>
    <a href="/es/">Casa</a>
  </div>
</nav>
</header>

  <main class="container">
    <h1>Blog</h1>
    <p class="lead">Entradas clasificadas por tema y por mes–año.</p>

    <section class="grid">
      <div class="card">
        <h3>Filtrar por tema</h3>
        <select id="topicSelect" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.12);">
          <option value="">Todos los temas</option>
        </select>

        <div style="margin-top:12px;">
          <input id="searchInput" type="search" placeholder="Buscar en títulos/resumen…"
            style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.12);" />
        </div>
      </div>

      <div class="card">
        <h3>Archivo</h3>
        <div id="archive"></div>
      </div>
    </section>

    <section class="section">
      <div class="card">
        <h3>Resultados</h3>
        <div id="results"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <small>© <span id="year"></span> Andrés Ahumada Gómez</small>
    </div>
  </footer>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const topicSelect = document.getElementById("topicSelect");
    const searchInput = document.getElementById("searchInput");
    const archiveEl = document.getElementById("archive");
    const resultsEl = document.getElementById("results");

function formatMonthYear(isoDate){
  const d = new Date(isoDate + "T00:00:00");
  return d.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long"
  });
}

    function formatDateEs(isoDate){
      const d = new Date(isoDate + "T00:00:00");
      return d.toLocaleDateString("es-ES", { year:"numeric", month:"long", day:"2-digit" });
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function buildTopics(posts){
      const topics = [...new Set(posts.map(p => p.topic).filter(Boolean))].sort((a,b)=>a.localeCompare(b,"es"));
      for(const t of topics){
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        topicSelect.appendChild(opt);
      }
    }

  const groups = new Map();

for(const p of posts){
  const d = new Date(p.date + "T00:00:00");
  const key = d.toLocaleDateString("en-US", { year: "numeric", month: "long" });
  const sortKey = d.getFullYear() * 100 + (d.getMonth() + 1); // YYYYMM numérico

  if(!groups.has(key)){
    groups.set(key, { sortKey, items: [] });
  }
  groups.get(key).items.push(p);
}

const sortedGroups = [...groups.entries()]
  .sort((a,b)=> b[1].sortKey - a[1].sortKey);

     archiveEl.innerHTML = sortedGroups.map(([label, group]) => {
  const items = group.items
    .sort((a,b)=> b.date.localeCompare(a.date))
    .map(p => `
      <li>
        <a href="${escapeHtml(p.url)}">${escapeHtml(p.title)}</a>
        <span style="color:var(--muted)"> — ${escapeHtml(p.topic || "")}</span>
        <div style="color:var(--muted); font-size:0.95rem;">${escapeHtml(p.excerpt || "")}</div>
      </li>
    `).join("");

  return `
    <h2 style="margin:16px 0 8px;">${label}</h2>
    <ul style="margin:0; padding-left:18px;">${items}</ul>
  `;
}).join("");
    }

    function renderResults(posts){
      const topic = topicSelect.value.trim();
      const q = searchInput.value.trim().toLowerCase();

      const filtered = posts.filter(p => {
        const okTopic = !topic || p.topic === topic;
        const hay = `${p.title || ""} ${p.excerpt || ""}`.toLowerCase();
        const okSearch = !q || hay.includes(q);
        return okTopic && okSearch;
      }).sort((a,b)=> b.date.localeCompare(a.date));

      if(filtered.length === 0){
        resultsEl.innerHTML = `<p style="color:var(--muted); margin:0;">No hay entradas que coincidan.</p>`;
        return;
      }

      resultsEl.innerHTML = filtered.map(p => `
        <div style="padding:12px 0; border-bottom:1px solid rgba(0,0,0,.08);">
          <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:baseline;">
            <a href="${escapeHtml(p.url)}" style="font-weight:700;">${escapeHtml(p.title)}</a>
            <span style="color:var(--muted);">(${escapeHtml(formatDateEs(p.date))})</span>
            ${p.topic ? `<span class="tags"><span>${escapeHtml(p.topic)}</span></span>` : ``}
          </div>
          ${p.excerpt ? `<div style="color:var(--muted); margin-top:6px;">${escapeHtml(p.excerpt)}</div>` : ``}
        </div>
      `).join("");
    }

    async function init(){
      const res = await fetch("/es/blog/posts.json", { cache: "no-store" });
      if(!res.ok){
        resultsEl.innerHTML = `<p style="color:var(--muted);">No pude cargar posts.json</p>`;
        return;
      }
      const posts = await res.json();

      // Normaliza y valida mínimamente
      for(const p of posts){
        if(!p.title || !p.date || !p.url) console.warn("Post incompleto:", p);
      }

      buildTopics(posts);
      buildArchive(posts);
      renderResults(posts);

      topicSelect.addEventListener("change", ()=>renderResults(posts));
      searchInput.addEventListener("input", ()=>renderResults(posts));
    }

    init();
  </script>
</body>
</html>

<!-- =========================
   AndrÃ©s Ahumada GÃ³mez â€” Blog
   ========================= -->

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog â€” Sitio matemÃ¡tico de AndrÃ©s</title>
  <meta name="description" content="Blog de AndrÃ©s Ahumada GÃ³mez." />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=CMU+Serif&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/cascadia-code/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono/index.css">
  <link rel="stylesheet" href="/styles.css" />

  <link rel="alternate" hreflang="en" href="https://andres-ahumada-gomez.github.io/en/" />
  <link rel="alternate" hreflang="es" href="https://andres-ahumada-gomez.github.io/es/" />
  <link rel="alternate" hreflang="x-default" href="https://andres-ahumada-gomez.github.io/" />
  <link rel="icon" type="image/png" href="/imgs/esf.png">
</head>

<body>
  <header class="site-header">
    <a class="brand" href="/es/">
      <img src="/imgs/andres-esf2.png" alt="Logo" class="brand-logo">
      AndrÃ©s Ahumada GÃ³mez
    </a>

    <nav class="nav">
      <a href="/es/">Casa</a>
      <a href="/es/#contacto">Contacto</a>

      <span class="nav-sep" aria-hidden="true">|</span>

      <div class="lang">
        <a href="/en/">Home</a>
        <a href="/es/">Casa</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <h1>Blog</h1>
    <p class="lead">Entradas clasificadas por tema y por aÃ±o.</p>

    <div class="blog-layout">
      <!-- Sidebar -->
      <aside class="blog-sidebar">
        <div class="card">
          <h3 class="docs-title">TOPICS</h3>
          <div id="topicsList" class="blog-links"></div>
        </div>

        <div class="card" style="margin-top:16px;">
          <h3 class="docs-title">YEAR</h3>
          <div id="yearsList" class="blog-links"></div>
        </div>
      </aside>

      <!-- Main list -->
      <section class="blog-content">
        <div class="card">
          <div id="postsContainer"></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <small>Â© <span id="year"></span> AndrÃ©s Ahumada GÃ³mez</small>
    </div>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const topicsList = document.getElementById("topicsList");
    const yearsList = document.getElementById("yearsList");
    const postsContainer = document.getElementById("postsContainer");

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function parseDate(iso){ return new Date(iso + "T00:00:00"); }
    function yearOf(iso){ return parseDate(iso).getFullYear(); }

    // Publicado: January 06, 2025 (en inglÃ©s como tu ejemplo)
    function publishedEn(iso){
      return parseDate(iso).toLocaleDateString("en-US", {
        year:"numeric", month:"long", day:"2-digit"
      });
    }

    function uniqueSorted(arr){
      return [...new Set(arr)].sort((a,b)=> a.localeCompare(b, "en"));
    }

    function groupByYear(posts){
      const map = new Map();
      for(const p of posts){
        const y = yearOf(p.date);
        if(!map.has(y)) map.set(y, []);
        map.get(y).push(p);
      }
      for(const [y, arr] of map.entries()){
        arr.sort((a,b)=> b.date.localeCompare(a.date));
      }
      return [...map.entries()].sort((a,b)=> b[0]-a[0]);
    }

    function renderSidebar(container, items, onClick){
      container.innerHTML = "";
      for(const it of items){
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = it;
        a.className = "blog-link";
        a.addEventListener("click", (e)=>{ e.preventDefault(); onClick(it); });
        container.appendChild(a);
      }
    }

    function renderPosts(grouped, filter){
      const blocks = [];

      for(const [y, posts] of grouped){
        if(filter.year && y !== filter.year) continue;

        const filteredPosts = filter.topic
          ? posts.filter(p => p.topic === filter.topic)
          : posts;

        if(filteredPosts.length === 0) continue;

        blocks.push(`<h2 class="blog-year">${y}</h2>`);

        for(const p of filteredPosts){
          blocks.push(`
            <article class="blog-post">
              <a class="blog-title" href="${escapeHtml(p.url)}">${escapeHtml(p.title)}</a>
              <div class="blog-meta">
                <span aria-hidden="true">ðŸ“…</span>
                <strong>Published:</strong> ${escapeHtml(publishedEn(p.date))}
              </div>
              ${p.excerpt ? `<p class="blog-excerpt">${escapeHtml(p.excerpt)}</p>` : ``}
            </article>
          `);
        }
      }

      postsContainer.innerHTML = blocks.length
        ? blocks.join("")
        : `<p style="color:var(--muted); margin:0;">No hay entradas para ese filtro.</p>`;
    }

    async function init(){
      try{
        // RUTA RELATIVA = robusto en GitHub Pages
        const res = await fetch("./posts.json", { cache: "no-store" });
        if(!res.ok){
          postsContainer.innerHTML = `<p style="color:var(--muted); margin:0;">No pude cargar posts.json (HTTP ${res.status}).</p>`;
          return;
        }

        const posts = await res.json();
        posts.sort((a,b)=> b.date.localeCompare(a.date));

        const topics = uniqueSorted(posts.map(p=>p.topic).filter(Boolean));
        const years = [...new Set(posts.map(p=>yearOf(p.date)))].sort((a,b)=> b-a);
        const grouped = groupByYear(posts);

        let state = { topic: null, year: null };

        function highlightActive(){
          document.querySelectorAll(".blog-link").forEach(a=>a.classList.remove("is-active"));
          if(state.topic){
            [...topicsList.querySelectorAll(".blog-link")]
              .find(a=>a.textContent===state.topic)?.classList.add("is-active");
          }
          if(state.year){
            [...yearsList.querySelectorAll(".blog-link")]
              .find(a=>a.textContent===String(state.year))?.classList.add("is-active");
          }
        }

        renderSidebar(topicsList, topics, (t)=>{
          state.topic = (state.topic === t) ? null : t;
          state.year = null;
          renderPosts(grouped, state);
          highlightActive();
        });

        renderSidebar(yearsList, years.map(String), (ys)=>{
          const y = Number(ys);
          state.year = (state.year === y) ? null : y;
          state.topic = null;
          renderPosts(grouped, state);
          highlightActive();
        });

        renderPosts(grouped, state);
      } catch(e){
        postsContainer.innerHTML = `<p style="color:var(--muted); margin:0;">Error: ${escapeHtml(e)}</p>`;
      }
    }

    init();
  </script>
</body>
</html>
